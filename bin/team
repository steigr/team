#!/bin/sh

PROJECT_REPO=https://github.com/steigr/team
PREFIX=${PREFIX:-/opt/lib/team}

mkdir -p $(dirname $PREFIX)
test -d $PREFIX/.git && (cd $PREFIX; git pull origin master >/dev/null) || git clone "$PROJECT_REPO" $PREFIX
test -L $0 || ( rm -rf $0 && ln -s $PREFIX/bin/team $0 )

cmd="$PREFIX/bin/team-${1:-serf-event}"; shift
[[ ! -f "$cmd" ]] && exit 1
TEAM_LIB=$(dirname $(readlink $0))/../lib $cmd $*
exit $?