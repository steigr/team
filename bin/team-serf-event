#!/bin/bash

. $TEAM_LIB/dependency.lib
require team
require random
require serf-event
require config

[[ "x" = "x$SERF_EVENT" ]] && exit 0

test "x$SERF_EVENT" = "xuser" && PAYLOAD=$(cat)
serf_event_handlers | while read handler; do
  if [[ "$SERF_EVENT" = "user" ]]; then
    echo $PAYLOAD | /bin/bash -i $handler $* &>/dev/null &
  else
    /bin/bash -i $handler $* 2>/dev/null
  fi
done

exit 0