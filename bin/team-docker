#!/bin/sh

set -x

. $TEAM_LIB/team.lib
. $TEAM_LIB/docker.lib
. $TEAM_LIB/coreos.lib

arg=$1
shift

case "$arg" in
  tcp-unit)
    docker_write_tcp_unit $(coreos_unit socket docker-tcp)
  ;;
  tcp-enable)
    coreos_stop docker
    coreos_socket docker-tcp
  ;;
  bound)
    case "$1" in
      tcp)
        coreos_unit_present docker-tcp.socket || exit 1
        coreos_unit_enabled docker-tcp.socket || exit 1
        exit 0
      ;;
    esac
  ;;
  bind)
    case "$1" in
      tcp)
        coreos_unit_present docker-tcp.socket || $TEAM docker tcp-unit
        coreos_unit_enabled docker-tcp.socket || $TEAM docker tcp-enable
      ;;
    esac
  ;;
esac