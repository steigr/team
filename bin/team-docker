#!/bin/sh

set -x

. $TEAM_LIB/team.lib
. $TEAM_LIB/docker.lib
. $TEAM_LIB/coreos.lib

arg=$1
shift

case "$arg" in
  tcp-unit)
    docker_write_tcp_unit $(coreos_unit socket docker-tcp)
  ;;
  tcp-enable)
    coreos_stop docker
    coreos_socket docker-tcp
  ;;
  bound)
    case "$1" in
      tcp)
        coreos_unit_present docker-tcp.socket || exit 1
        coreos_status docker-tcp.socket
        exit $?
      ;;
    esac
  ;;
  bind)
    case "$1" in
      tcp)
        $TEAM docker bound tcp
        if [[ $? -gt 0 ]]; then
          echo "Binding to $(docker_tcp_port)"
          $TEAM docker tcp-unit
          $TEAM docker tcp-enable
        fi
      ;;
    esac
  ;;
esac