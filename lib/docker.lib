require coreos

_docker_tcp_port() {
  echo "4375"
}

docker_write_tcp_unit() {
  cat <<EO_DOCKER_UNIT | tee $1
[Unit]
Description=Docker Socket for the API

[Socket]
ListenStream=$(_docker_tcp_port)
BindIPv6Only=both
Service=docker.service

[Install]
WantedBy=sockets.target
EO_DOCKER_UNIT
}

_docker_id_by_name() {
  docker inspect --format '{{ .Id }}' $1
}

_docker_name_by_id() {
  docker inspect --format='{{ .Name }}' $1 | sed -e 's:^/::g'
}

_docker_ids_by_image() {
  if [[ $# -eq 2 ]]; then
    op=$1
    image=$2
  else
    image=$1
  fi
  docker ps $op -q | while read iid; do
    imid=$(docker inspect --format='{{ .Image }}' $iid)
    imname=$(docker inspect --format='{{ .ContainerConfig.Image }}' $imid)
    test "x$image" = "x$imname" && echo $iid
  done
}

_docker_ip() {
  docker inspect --format '{{ .NetworkSettings.IPAddress }}' $1
}

_docker() {
  which docker
}